(function(i){"use strict";function e(e){return this.each(function(){var o=i(this),n="object"==typeof e&&e,a=o.data("bsmodal");if(!a){a=new t(this,n);a.$element.data("bsmodal",a)}if("string"==typeof e){var s=["show","hide","destroy"];if(i.inArray(e,s)<0)return console.error(c('方法:jDialog("{0}")不存在!',e)),!1;a[e]()}})}var t=function(e,o){this.$element=i(e),this.originalPosition={},this.originalElement={},this.$body=i("html body"),this.$doc=i(document),r(t.Defaults,o),this.options=i.extend({},t.Defaults,o),h(this.options,o),this.currentDialog="",this.currentDialogID="",this.init()};t.Version="1.1.0",t.Defaults={title:"Dialog",width:470,height:220,minWidth:150,minHeight:150,closeOnEscape:!0,resizable:!0,menus:[{text:"munu1",type:"menu",item:[{text:"submenu1",fn:function(){}}],fn:function(){}}],buttons:[{id:"",text:"btn1",fn:function(){}}],close:function(i){}},t.prototype.init=function(){var i=this,e=(i.options,n(i)),t="JDialog_"+e;i.currentDialogID=t,g(i),o(i),s(i),a(i)},t.prototype.show=function(){var e=.5*i(window).width()-.5*this.currentDialog.width(),t=.5*i(window).height()-.5*this.currentDialog.height();this.currentDialog.css({left:e,top:t}),this.$body.append("<div class='JDialog-backdrop'></div>"),this.$body.addClass("JDialog-open"),this.currentDialog.show(),l(this)},t.prototype.hide=function(){this.currentDialog.hide(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")},t.prototype.destroy=function(){var i,e=this.originalPosition;i=e.parent.children().eq(e.index),i.length&&i[0]!==this.originalElement[0]?i.before(this.originalElement):e.parent.append(this.originalElement),this.currentDialog.remove(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")};var o=function(e){var t=e.options,o=[],n=t.width;n=n<t.minWidth?t.minWidth:n;var a=t.height;a=a<t.minHeight?t.minHeight:a,o.push(c("<div id='{0}' class='JDialog' tabindex='-1' style='display:none;'>",e.currentDialogID)),o.push(c("<div class='JDialog-dialog' style='width:{0};height:{1}'>",n+"px",a+"px")),o.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-n":"")),o.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-e":"")),o.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-s":"")),o.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-w":"")),o.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-se":"")),o.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-sw":"")),o.push("<div class='JDialog-content'>"),o.push("<div class='JDialog-header'>"),o.push("<button type='button' class='close'><span>×</span></button>"),o.push(c("<h4 class='JDialog-title'>{0}</h4>",t.title)),o.push("</div>"),o.push("<div class='JDialog-menu'>"),o.push("</div>"),o.push("<div class='JDialog-body'>"),o.push(e.$element.clone().show().prop("outerHTML")),o.push("</div>"),t.buttons.length>0&&(o.push("<div class='JDialog-footer'>"),i.each(t.buttons,function(i,e){o.push(c("<button class='btn btn-default' id='{1}'>{0}</button>",e.text,e.id))}),o.push("</div>")),o.push("</div>"),o.push("</div>"),o.push("</div>"),e.$body.append(o.join("")),e.originalPosition={parent:e.$element.parent(),index:e.$element.parent().children().index(e.$element)},e.originalElement=e.$element.clone(),e.$element.remove(),e.currentDialog=i("#"+e.currentDialogID),e.$element=e.currentDialog.find(".JDialog-content .JDialog-body").children().eq(0)},n=function(e){var t=e.$body.children(".JDialog"),o=[];t.each(function(e,t){var n=i(t),a=parseInt(n.attr("id").replace("JDialog_",""));o.push(a)});var n=o.length?d(o):0,a=n+1;return a},a=function(e){var t=e.options;e.currentDialog.find(".JDialog-header").off().mouseover(function(){i(this).css("cursor","move")}).mousedown(function(t){var o=!0,n=t.pageX-i(this).parent().offset().left,a=t.pageY-i(this).parent().offset().top;e.$doc.mousemove(function(i){o&&e.currentDialog.offset({left:i.pageX-n,top:i.pageY-a})}).mouseup(function(){o=!1,e.$doc.off("mousemove mouseup")})}),t.resizable&&e.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").off().mousedown(function(o){var n,a,s,r,h,g,d,c,u,p,f,D=i(this),v=D.attr("class"),m=v.split(" ")[1].split("-")[2];p=!0,r=D.parent(".JDialog-dialog").offset().top,a=o.pageY,h=D.parent(".JDialog-dialog").outerHeight(),u=D.parent(".JDialog-dialog").offset().left,c=o.pageX,f=D.parent(".JDialog-dialog").outerWidth(),e.$doc.mousemove(function(i){if(p)switch(n=i.pageY,g=i.pageX,d=g-c,s=n-a,m){case"n":var o=h-s;o=o<t.minHeight?t.minHeight:o,D.parent(".JDialog-dialog").height(o+"px"),D.parents(".JDialog").css("top",r+h-o+"px"),l(e);break;case"e":var v=f+d;v=v<t.minWidth?t.minWidth:v,D.parent(".JDialog-dialog").width(v+"px");break;case"s":o=h+s;o=o<t.minHeight?t.minHeight:o,D.parent(".JDialog-dialog").height(o+"px"),l(e);break;case"w":v=f-d;v=v<t.minWidth?t.minWidth:v,D.parent(".JDialog-dialog").width(v+"px"),D.parents(".JDialog").css("left",u+(f-v)+"px");break;case"se":v=f+d;v=v<t.minWidth?t.minWidth:v;o=h+s;o=o<t.minHeight?t.minHeight:o,D.parent(".JDialog-dialog").width(v+"px"),D.parent(".JDialog-dialog").height(o+"px"),l(e);break;case"sw":o=h+s;o=o<t.minHeight?t.minHeight:o;v=f-d;v=v<t.minWidth?t.minWidth:v,D.parent(".JDialog-dialog").width(v+"px"),D.parent(".JDialog-dialog").height(o+"px"),D.parents(".JDialog").css("left",u+(f-v)+"px"),l(e)}}).mouseup(function(i){p=!1,i.preventDefault(),i.stopPropagation(),e.$doc.off("mousemove mouseup")})})},s=function(e){var t=e.options;e.currentDialog.find("div.JDialog-content div.JDialog-header button.close").off("click").on("click",function(i){e.hide(),t.close&&"function"==typeof t.close&&t.close(i)}),e.currentDialog.find("div.JDialog-content div.JDialog-footer button").off("click").on("click",function(){var e=i(this),o=e.attr("id"),n=i.grep(t.buttons,function(i,e){if(i.id==o)return!0},!1);n[0].fn(this,event)}),e.currentDialog.on("keydown",function(i){t.closeOnEscape&&27==i.keyCode&&(e.hide(),t.close&&"function"==typeof t.close&&t.close(event))})},l=function(i){i.options;var e=i.currentDialog.find(".JDialog-dialog").height(),t=i.currentDialog.find(".JDialog-body").outerHeight()-i.currentDialog.find(".JDialog-body").height(),o=i.currentDialog.find(".JDialog-header").outerHeight(),n=i.currentDialog.find(".JDialog-footer").outerHeight(),a=(e-t-o-n).toString()+"px";i.currentDialog.find(".JDialog-body").height(a)},r=function(e,t){for(var o in t)if(t.hasOwnProperty(o)&&i.isArray(t[o])&&e.hasOwnProperty(o)){for(var n=[],a=t[o],s=0;s<a.length;s++){var l=a[s],g=i.extend(!0,{},e[o][0],l);h(g,l),n.push(g)}t[o]=n}else i.isPlainObject(t[o])&&r(e[o],t[o])},h=function(e,t){for(var o in e)e.hasOwnProperty(o)&&i.isArray(e[o])&&!t.hasOwnProperty(o)?e[o]=[]:i.isPlainObject(e[o])&&r(e[o],t[o])},g=function(e){var t=e.options,o=new Date,n=("0"+(o.getMonth()+1)).slice(-2)+("0"+o.getDate()).slice(-2),a=e.currentDialogID.replace(/^.+_/g,"");t.buttons.length>0&&i.each(t.buttons,function(i,e){if(""==e.id){Math.ceil(100*Math.random());var t=a+n+i;e.id=t}})},d=function(i){for(var e=i[0],t=i.length,o=1;o<t;o++)i[o]>e&&(e=i[o]);return e},c=function(i){var e=arguments;return i.replace(/\{(\d+)\}/g,function(i,t){return t=parseInt(t),e[t+1]})},u=i.fn.jDialog;i.fn.jDialog=e,i.fn.jDialog.Constructor=t,i.fn.jDialog.noConflict=function(){return i.fn.jDialog=u,this}})(jQuery);