(function(i){"use strict";function t(t){return this.each(function(){var e=i(this),n="object"==typeof t&&t,a=e.data("bsmodal");if(!a){a=new o(this,n);e.data("bsmodal",a)}if("string"==typeof t){var r=["show","hide","destroy"];if(i.inArray(t,r)<0)return console.error('方法:jDialog("{0}")不存在!'.formatString(t)),!1;a[t]()}})}var o=function(t,e){this.$element=i(t),this.$body=i("html body"),this.$doc=i(document),l(o.Defaults,e),this.options=i.extend({},o.Defaults,e),this.currentDialog="",this.currentDialogID="",this.init()};o.Version="1.1.0",o.Defaults={title:"Dialog",width:470,height:220,minWidth:150,minHeight:150,closeOnEscape:!0,resizable:!0,menus:[{text:"munu1",type:"menu",item:[{text:"submenu1",fn:function(){}}],fn:function(){}}],buttons:[{id:"",text:"btn1",fn:function(){}}],close:function(i){}},o.prototype.init=function(){var i=this,t=(i.options,n(i)),o="JDialog_"+t;i.currentDialogID=o,g(i),e(i),r(i),a(i)},o.prototype.show=function(){var t=.5*i(window).width()-.5*this.currentDialog.width(),o=.5*i(window).height()-.5*this.currentDialog.height();this.currentDialog.css({left:t,top:o}),this.$body.append("<div class='JDialog-backdrop'></div>"),this.$body.addClass("JDialog-open"),this.currentDialog.show(),s(this)},o.prototype.hide=function(){this.currentDialog.hide(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")},o.prototype.destroy=function(){this.currentDialog.remove(),this.$element.removeData("bsmodal")};var e=function(t){var o=t.options,e=[],n=o.width;n=n<o.minWidth?o.minWidth:n;var a=o.height;a=a<o.minHeight?o.minHeight:a,e.push("<div id='{0}' class='JDialog' tabindex='-1' style='display:none;'>".formatString(t.currentDialogID)),e.push("<div class='JDialog-dialog' style='width:{0};height:{1}'>".formatString(n+"px",a+"px")),e.push("<div class='JDialog-resizable-handle {0}'></div>".formatString(o.resizable?"JDialog-resizable-n":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".formatString(o.resizable?"JDialog-resizable-e":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".formatString(o.resizable?"JDialog-resizable-s":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".formatString(o.resizable?"JDialog-resizable-w":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".formatString(o.resizable?"JDialog-resizable-se":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".formatString(o.resizable?"JDialog-resizable-sw":"")),e.push("<div class='JDialog-content'>"),e.push("<div class='JDialog-header'>"),e.push("<button type='button' class='close'><span>×</span></button>"),e.push("<h4 class='JDialog-title'>{0}</h4>".formatString(o.title)),e.push("</div>"),e.push("<div class='JDialog-menu'>"),e.push("</div>"),e.push("<div class='JDialog-body'>"),e.push(t.$element.html()),e.push("</div>"),o.buttons.length>0&&(e.push("<div class='JDialog-footer'>"),i.each(o.buttons,function(i,t){e.push("<button class='btn btn-default' id='{1}'>{0}</button>".formatString(t.text,t.id))}),e.push("</div>")),e.push("</div>"),e.push("</div>"),e.push("</div>"),t.$body.append(e.join("")),t.currentDialog=i("#"+t.currentDialogID)},n=function(t){var o=t.$body.children(".JDialog"),e=[];o.each(function(t,o){var n=i(o),a=parseInt(n.attr("id").replace("JDialog_",""));e.push(a)});var n=e.length?e.max():0,a=n+1;return a},a=function(t){var o=t.options;t.currentDialog.find(".JDialog-header").off().mouseover(function(){i(this).css("cursor","move")}).mousedown(function(o){var e=!0,n=o.pageX-i(this).parent().offset().left,a=o.pageY-i(this).parent().offset().top;t.$doc.mousemove(function(i){e&&t.currentDialog.offset({left:i.pageX-n,top:i.pageY-a})}).mouseup(function(){e=!1,t.$doc.off("mousemove mouseup")})}),o.resizable&&t.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").off().mousedown(function(e){var n,a,r,l,g,h,d,u,c,p,f,D=i(this),m=D.attr("class"),v=m.split(" ")[1].split("-")[2];p=!0,l=D.parent(".JDialog-dialog").offset().top,a=e.pageY,g=D.parent(".JDialog-dialog").outerHeight(),c=D.parent(".JDialog-dialog").offset().left,u=e.pageX,f=D.parent(".JDialog-dialog").outerWidth(),t.$doc.mousemove(function(i){if(p)switch(n=i.pageY,h=i.pageX,d=h-u,r=n-a,v){case"n":var e=g-r;e=e<o.minHeight?o.minHeight:e,D.parent(".JDialog-dialog").height(e+"px"),D.parents(".JDialog").css("top",l+g-e+"px"),s(t);break;case"e":var m=f+d;m=m<o.minWidth?o.minWidth:m,D.parent(".JDialog-dialog").width(m+"px");break;case"s":e=g+r;e=e<o.minHeight?o.minHeight:e,D.parent(".JDialog-dialog").height(e+"px"),s(t);break;case"w":m=f-d;m=m<o.minWidth?o.minWidth:m,D.parent(".JDialog-dialog").width(m+"px"),D.parents(".JDialog").css("left",c+(f-m)+"px");break;case"se":m=f+d;m=m<o.minWidth?o.minWidth:m;e=g+r;e=e<o.minHeight?o.minHeight:e,D.parent(".JDialog-dialog").width(m+"px"),D.parent(".JDialog-dialog").height(e+"px"),s(t);break;case"sw":e=g+r;e=e<o.minHeight?o.minHeight:e;m=f-d;m=m<o.minWidth?o.minWidth:m,D.parent(".JDialog-dialog").width(m+"px"),D.parent(".JDialog-dialog").height(e+"px"),D.parents(".JDialog").css("left",c+(f-m)+"px"),s(t)}}).mouseup(function(i){p=!1,i.preventDefault(),i.stopPropagation(),t.$doc.off("mousemove mouseup")})})},r=function(t){var o=t.options;t.currentDialog.find("div.JDialog-content div.JDialog-header button.close").off("click").on("click",function(i){t.hide(),o.close&&"function"==typeof o.close&&o.close(i)}),t.currentDialog.find("div.JDialog-content div.JDialog-footer button").off("click").on("click",function(){var t=i(this),e=t.attr("id"),n=i.grep(o.buttons,function(i,t){if(i.id==e)return!0},!1);n[0].fn(this,event)}),t.currentDialog.on("keydown",function(i){o.closeOnEscape&&27==i.keyCode&&(t.hide(),o.close&&"function"==typeof o.close&&o.close(event))})},s=function(i){i.options;var t=i.currentDialog.find(".JDialog-dialog").height(),o=i.currentDialog.find(".JDialog-body").outerHeight()-i.currentDialog.find(".JDialog-body").height(),e=i.currentDialog.find(".JDialog-header").outerHeight(),n=i.currentDialog.find(".JDialog-footer").outerHeight(),a=(t-o-e-n).toString()+"px";i.currentDialog.find(".JDialog-body").height(a)},l=function(t,o){for(var e in o)if(o.hasOwnProperty(e)&&i.isArray(o[e])&&t.hasOwnProperty(e)){for(var n=[],a=o[e],r=0;r<a.length;r++){var s=a[r],g=i.extend(!0,{},t[e][0],s);n.push(g)}o[e]=n}else i.isPlainObject(o[e])&&l(t[e],o[e])},g=function(t){var o=t.options,e=new Date,n=("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2),a=t.currentDialogID.replace(/^.+_/g,"");o.buttons.length>0&&i.each(o.buttons,function(i,t){if(""==t.id){var o=Math.ceil(100*Math.random()),e=a+n+i+o;t.id=e}})},h=i.fn.jDialog;i.fn.jDialog=t,i.fn.jDialog.Constructor=o,i.fn.jDialog.noConflict=function(){return i.fn.jDialog=h,this},void 0===String.prototype.formatString&&(String.prototype.formatString=function(){var i=arguments;return this.replace(/\{(\d+)\}/g,function(t,o){return i[o]})}),void 0===Array.prototype.max&&(Array.prototype.max=function(){for(var i=this[0],t=this.length,o=1;o<t;o++)this[o]>i&&(i=this[o]);return i})})(jQuery);