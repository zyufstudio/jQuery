(function(t){"use strict";function o(o){return this.each(function(){var e=t(this),a="object"==typeof o&&o,n=e.data("bsmodal");if(!n){n=new i(this,a);e.data("bsmodal",n)}if("string"==typeof o){var s=["show","hide","destroy"];if(t.inArray(o,s)<0)return console.error('方法:jDialog("{0}")不存在!'.format(o)),!1;n[o]()}})}var i=function(o,e){this.$element=t(o),this.$body=t("html body"),this.$doc=t(document),this.options=t.extend({},i.Defaults,e),this.currentDialog="",this.currentDialogID="",this.init()};i.Version="1.1.0",i.Defaults={title:"Dialog",width:470,height:220,minWidth:150,minHeight:150,resizable:!0,buttons:{},close:function(t){}},i.prototype.init=function(){var t=this,o=(t.options,a(t)),i="modal_"+o;t.currentDialogID=i,e(t),s(t),n(t)},i.prototype.show=function(){var o=.5*t(window).width()-.5*this.currentDialog.width(),i=100;this.currentDialog.css({left:o,top:i}),this.$body.append("<div class='modal-backdrop'></div>"),this.$body.addClass("modal-open"),this.currentDialog.show(),r(this)},i.prototype.hide=function(){this.currentDialog.hide(),this.$body.find(".modal-backdrop").remove(),this.$body.removeClass("modal-open")},i.prototype.destroy=function(){this.currentDialog.remove(),this.$element.removeData("bsmodal")};var e=function(o){var i=o.options,e=[],a=i.width;a=a<i.minWidth?i.minWidth:a;var n=i.height;n=n<i.minHeight?i.minHeight:n,e.push("<div id='{0}' class='modal' style='display:none;'>".format(o.currentDialogID)),e.push("<div class='modal-dialog' style='width:{0};height:{1}'>".format(a+"px",n+"px")),e.push("<div class='modal-resizable-handle {0}'></div>".format(i.resizable?"modal-resizable-n":"")),e.push("<div class='modal-resizable-handle {0}'></div>".format(i.resizable?"modal-resizable-e":"")),e.push("<div class='modal-resizable-handle {0}'></div>".format(i.resizable?"modal-resizable-s":"")),e.push("<div class='modal-resizable-handle {0}'></div>".format(i.resizable?"modal-resizable-w":"")),e.push("<div class='modal-resizable-handle {0}'></div>".format(i.resizable?"modal-resizable-se":"")),e.push("<div class='modal-resizable-handle {0}'></div>".format(i.resizable?"modal-resizable-sw":"")),e.push("<div class='modal-content'>"),e.push("<div class='modal-header'>"),e.push("<button type='button' class='close'><span>×</span></button>"),e.push("<h4 class='modal-title'>{0}</h4>".format(i.title)),e.push("</div>"),e.push("<div class='modal-body'>"),e.push(o.$element.html()),e.push("</div>"),t.isEmptyObject(i.buttons)||(e.push("<div class='modal-footer'>"),t.each(i.buttons,function(t,o){e.push("<button class='btn btn-default'>{0}</button>".format(t))}),e.push("</div>")),e.push("</div>"),e.push("</div>"),e.push("</div>"),o.$body.append(e.join("")),o.currentDialog=t("#"+o.currentDialogID)},a=function(o){var i=o.$body.children(".modal"),e=[];i.each(function(o,i){var a=t(i),n=parseInt(a.attr("id").replace("modal_",""));e.push(n)});var a=e.length?e.max():0,n=a+1;return n},n=function(o){var i=o.options;o.currentDialog.find(".modal-header").off().mouseover(function(){t(this).css("cursor","move")}).mousedown(function(i){var e=!0,a=i.pageX-t(this).parent().offset().left,n=i.pageY-t(this).parent().offset().top;o.$doc.mousemove(function(t){e&&o.currentDialog.offset({left:t.pageX-a,top:t.pageY-n})}).mouseup(function(){e=!1,o.$doc.off("mousemove mouseup")})}),i.resizable&&o.currentDialog.find(".modal-dialog .modal-resizable-handle").off().mousedown(function(e){var a,n,s,d,l,h,m,u,c,p,f,g=t(this),v=g.attr("class"),b=v.split(" ")[1].split("-")[2];p=!0,d=g.parent(".modal-dialog").offset().top,n=e.pageY,l=g.parent(".modal-dialog").outerHeight(),c=g.parent(".modal-dialog").offset().left,u=e.pageX,f=g.parent(".modal-dialog").outerWidth(),o.$doc.mousemove(function(t){if(p)switch(a=t.pageY,h=t.pageX,m=h-u,s=a-n,b){case"n":var e=l-s;e=e<i.minHeight?i.minHeight:e,g.parent(".modal-dialog").height(e+"px"),g.parents(".modal").css("top",d+l-e+"px"),r(o);break;case"e":var v=f+m;v=v<i.minWidth?i.minWidth:v,g.parent(".modal-dialog").width(v+"px");break;case"s":e=l+s;e=e<i.minHeight?i.minHeight:e,g.parent(".modal-dialog").height(e+"px"),r(o);break;case"w":v=f-m;v=v<i.minWidth?i.minWidth:v,g.parent(".modal-dialog").width(v+"px"),g.parents(".modal").css("left",c+(f-v)+"px");break;case"se":v=f+m;v=v<i.minWidth?i.minWidth:v;e=l+s;e=e<i.minHeight?i.minHeight:e,g.parent(".modal-dialog").width(v+"px"),g.parent(".modal-dialog").height(e+"px"),r(o);break;case"sw":e=l+s;e=e<i.minHeight?i.minHeight:e;v=f-m;v=v<i.minWidth?i.minWidth:v,g.parent(".modal-dialog").width(v+"px"),g.parent(".modal-dialog").height(e+"px"),g.parents(".modal").css("left",c+(f-v)+"px"),r(o)}}).mouseup(function(t){p=!1,t.preventDefault(),t.stopPropagation(),o.$doc.off("mousemove mouseup")})})},s=function(o){var i=o.options;o.currentDialog.find("div.modal-content div.modal-header button.close").off("click").on("click",function(t){o.hide(),i.close&&"function"==typeof i.close&&i.close(t)}),o.currentDialog.find("div.modal-content div.modal-footer button").off("click").on("click",function(){var o=t(this);i.buttons[o.text()](this,event)})},r=function(t){t.options;var o=t.currentDialog.find(".modal-dialog").height(),i=t.currentDialog.find(".modal-body").outerHeight()-t.currentDialog.find(".modal-body").height(),e=t.currentDialog.find(".modal-header").outerHeight(),a=t.currentDialog.find(".modal-footer").outerHeight(),n=(o-i-e-a).toString()+"px";t.currentDialog.find(".modal-body").height(n)},d=t.fn.jDialog;t.fn.jDialog=o,t.fn.jDialog.Constructor=i,t.fn.jDialog.noConflict=function(){return t.fn.jDialog=d,this},void 0===String.prototype.format&&(String.prototype.format=function(){var t=arguments;return this.replace(/\{(\d+)\}/g,function(o,i){return t[i]})}),void 0===Array.prototype.max&&(Array.prototype.max=function(){for(var t=this[0],o=this.length,i=1;i<o;i++)this[i]>t&&(t=this[i]);return t})})(jQuery);