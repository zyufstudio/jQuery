(function(i){"use strict";function t(t){return this.each(function(){var o=i(this),n="object"==typeof t&&t,a=o.data("bsmodal");if(!a){a=new e(this,n);o.data("bsmodal",a)}if("string"==typeof t){var s=["show","hide","destroy"];if(i.inArray(t,s)<0)return console.error(d('方法:jDialog("{0}")不存在!',t)),!1;a[t]()}})}var e=function(t,o){this.$element=i(t),this.$body=i("html body"),this.$doc=i(document),r(e.Defaults,o),this.options=i.extend({},e.Defaults,o),this.currentDialog="",this.currentDialogID="",this.init()};e.Version="1.1.0",e.Defaults={title:"Dialog",width:470,height:220,minWidth:150,minHeight:150,closeOnEscape:!0,resizable:!0,menus:[{text:"munu1",type:"menu",item:[{text:"submenu1",fn:function(){}}],fn:function(){}}],buttons:[{id:"",text:"btn1",fn:function(){}}],close:function(i){}},e.prototype.init=function(){var i=this,t=(i.options,n(i)),e="JDialog_"+t;i.currentDialogID=e,h(i),o(i),s(i),a(i)},e.prototype.show=function(){var t=.5*i(window).width()-.5*this.currentDialog.width(),e=.5*i(window).height()-.5*this.currentDialog.height();this.currentDialog.css({left:t,top:e}),this.$body.append("<div class='JDialog-backdrop'></div>"),this.$body.addClass("JDialog-open"),this.currentDialog.show(),l(this)},e.prototype.hide=function(){this.currentDialog.hide(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")},e.prototype.destroy=function(){this.currentDialog.remove(),this.$element.removeData("bsmodal")};var o=function(t){var e=t.options,o=[],n=e.width;n=n<e.minWidth?e.minWidth:n;var a=e.height;a=a<e.minHeight?e.minHeight:a,o.push(d("<div id='{0}' class='JDialog' tabindex='-1' style='display:none;'>",t.currentDialogID)),o.push(d("<div class='JDialog-dialog' style='width:{0};height:{1}'>",n+"px",a+"px")),o.push(d("<div class='JDialog-resizable-handle {0}'></div>",e.resizable?"JDialog-resizable-n":"")),o.push(d("<div class='JDialog-resizable-handle {0}'></div>",e.resizable?"JDialog-resizable-e":"")),o.push(d("<div class='JDialog-resizable-handle {0}'></div>",e.resizable?"JDialog-resizable-s":"")),o.push(d("<div class='JDialog-resizable-handle {0}'></div>",e.resizable?"JDialog-resizable-w":"")),o.push(d("<div class='JDialog-resizable-handle {0}'></div>",e.resizable?"JDialog-resizable-se":"")),o.push(d("<div class='JDialog-resizable-handle {0}'></div>",e.resizable?"JDialog-resizable-sw":"")),o.push("<div class='JDialog-content'>"),o.push("<div class='JDialog-header'>"),o.push("<button type='button' class='close'><span>×</span></button>"),o.push(d("<h4 class='JDialog-title'>{0}</h4>",e.title)),o.push("</div>"),o.push("<div class='JDialog-menu'>"),o.push("</div>"),o.push("<div class='JDialog-body'>"),o.push(t.$element.html()),o.push("</div>"),e.buttons.length>0&&(o.push("<div class='JDialog-footer'>"),i.each(e.buttons,function(i,t){o.push(d("<button class='btn btn-default' id='{1}'>{0}</button>",t.text,t.id))}),o.push("</div>")),o.push("</div>"),o.push("</div>"),o.push("</div>"),t.$body.append(o.join("")),t.currentDialog=i("#"+t.currentDialogID)},n=function(t){var e=t.$body.children(".JDialog"),o=[];e.each(function(t,e){var n=i(e),a=parseInt(n.attr("id").replace("JDialog_",""));o.push(a)});var n=o.length?g(o):0,a=n+1;return a},a=function(t){var e=t.options;t.currentDialog.find(".JDialog-header").off().mouseover(function(){i(this).css("cursor","move")}).mousedown(function(e){var o=!0,n=e.pageX-i(this).parent().offset().left,a=e.pageY-i(this).parent().offset().top;t.$doc.mousemove(function(i){o&&t.currentDialog.offset({left:i.pageX-n,top:i.pageY-a})}).mouseup(function(){o=!1,t.$doc.off("mousemove mouseup")})}),e.resizable&&t.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").off().mousedown(function(o){var n,a,s,r,h,g,d,u,c,p,f,D=i(this),v=D.attr("class"),b=v.split(" ")[1].split("-")[2];p=!0,r=D.parent(".JDialog-dialog").offset().top,a=o.pageY,h=D.parent(".JDialog-dialog").outerHeight(),c=D.parent(".JDialog-dialog").offset().left,u=o.pageX,f=D.parent(".JDialog-dialog").outerWidth(),t.$doc.mousemove(function(i){if(p)switch(n=i.pageY,g=i.pageX,d=g-u,s=n-a,b){case"n":var o=h-s;o=o<e.minHeight?e.minHeight:o,D.parent(".JDialog-dialog").height(o+"px"),D.parents(".JDialog").css("top",r+h-o+"px"),l(t);break;case"e":var v=f+d;v=v<e.minWidth?e.minWidth:v,D.parent(".JDialog-dialog").width(v+"px");break;case"s":o=h+s;o=o<e.minHeight?e.minHeight:o,D.parent(".JDialog-dialog").height(o+"px"),l(t);break;case"w":v=f-d;v=v<e.minWidth?e.minWidth:v,D.parent(".JDialog-dialog").width(v+"px"),D.parents(".JDialog").css("left",c+(f-v)+"px");break;case"se":v=f+d;v=v<e.minWidth?e.minWidth:v;o=h+s;o=o<e.minHeight?e.minHeight:o,D.parent(".JDialog-dialog").width(v+"px"),D.parent(".JDialog-dialog").height(o+"px"),l(t);break;case"sw":o=h+s;o=o<e.minHeight?e.minHeight:o;v=f-d;v=v<e.minWidth?e.minWidth:v,D.parent(".JDialog-dialog").width(v+"px"),D.parent(".JDialog-dialog").height(o+"px"),D.parents(".JDialog").css("left",c+(f-v)+"px"),l(t)}}).mouseup(function(i){p=!1,i.preventDefault(),i.stopPropagation(),t.$doc.off("mousemove mouseup")})})},s=function(t){var e=t.options;t.currentDialog.find("div.JDialog-content div.JDialog-header button.close").off("click").on("click",function(i){t.hide(),e.close&&"function"==typeof e.close&&e.close(i)}),t.currentDialog.find("div.JDialog-content div.JDialog-footer button").off("click").on("click",function(){var t=i(this),o=t.attr("id"),n=i.grep(e.buttons,function(i,t){if(i.id==o)return!0},!1);n[0].fn(this,event)}),t.currentDialog.on("keydown",function(i){e.closeOnEscape&&27==i.keyCode&&(t.hide(),e.close&&"function"==typeof e.close&&e.close(event))})},l=function(i){i.options;var t=i.currentDialog.find(".JDialog-dialog").height(),e=i.currentDialog.find(".JDialog-body").outerHeight()-i.currentDialog.find(".JDialog-body").height(),o=i.currentDialog.find(".JDialog-header").outerHeight(),n=i.currentDialog.find(".JDialog-footer").outerHeight(),a=(t-e-o-n).toString()+"px";i.currentDialog.find(".JDialog-body").height(a)},r=function(t,e){for(var o in e)if(e.hasOwnProperty(o)&&i.isArray(e[o])&&t.hasOwnProperty(o)){for(var n=[],a=e[o],s=0;s<a.length;s++){var l=a[s],h=i.extend(!0,{},t[o][0],l);n.push(h)}e[o]=n}else i.isPlainObject(e[o])&&r(t[o],e[o])},h=function(t){var e=t.options,o=new Date,n=("0"+(o.getMonth()+1)).slice(-2)+("0"+o.getDate()).slice(-2),a=t.currentDialogID.replace(/^.+_/g,"");e.buttons.length>0&&i.each(e.buttons,function(i,t){if(""==t.id){var e=Math.ceil(100*Math.random()),o=a+n+i+e;t.id=o}})},g=function(i){for(var t=i[0],e=i.length,o=1;o<e;o++)i[o]>t&&(t=i[o]);return t},d=function(i){var t=arguments;return i.replace(/\{(\d+)\}/g,function(i,e){return e=parseInt(e),t[e+1]})},u=i.fn.jDialog;i.fn.jDialog=t,i.fn.jDialog.Constructor=e,i.fn.jDialog.noConflict=function(){return i.fn.jDialog=u,this}})(jQuery);