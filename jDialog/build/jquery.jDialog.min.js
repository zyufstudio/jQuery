(function(i){"use strict";function t(t){return this.each(function(){var e=i(this),a="object"==typeof t&&t,n=e.data("bsmodal");if(!n){n=new o(this,a);e.data("bsmodal",n)}if("string"==typeof t){var s=["show","hide"];if(i.inArray(t,s)<0)return console.error('方法:jDialog("{0}")不存在!'.format(t)),!1;n[t]()}})}var o=function(t,e){this.$element=i(t),this.$body=i("html body"),this.$doc=i(document),this.options=i.extend({},o.Defaults,e),this.currentDialog="",this.currentDialogID="",this.init()};o.Version="1.1.0",o.Defaults={title:"Dialog",width:470,height:220,minWidth:150,minHeight:150,resizable:!0,buttons:{},close:function(i){}},o.prototype.init=function(){var i=this,t=(i.options,a(i)),o="JDialog_"+t;i.currentDialogID=o,e(i),s(i),n(i)},o.prototype.show=function(){var t=.5*i(window).width()-.5*this.currentDialog.width(),o=.5*i(window).height()-.5*this.currentDialog.height();this.currentDialog.css({left:t,top:o}),this.$body.append("<div class='JDialog-backdrop'></div>"),this.$body.addClass("JDialog-open"),this.currentDialog.show(),r(this)},o.prototype.hide=function(){this.currentDialog.hide(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")};var e=function(t){var o=t.options,e=[],a=o.width;a=a<o.minWidth?o.minWidth:a;var n=o.height;n=n<o.minHeight?o.minHeight:n,e.push("<div id='{0}' class='JDialog' style='display:none;'>".format(t.currentDialogID)),e.push("<div class='JDialog-dialog' style='width:{0};height:{1}'>".format(a+"px",n+"px")),e.push("<div class='JDialog-resizable-handle {0}'></div>".format(o.resizable?"JDialog-resizable-n":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".format(o.resizable?"JDialog-resizable-e":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".format(o.resizable?"JDialog-resizable-s":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".format(o.resizable?"JDialog-resizable-w":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".format(o.resizable?"JDialog-resizable-se":"")),e.push("<div class='JDialog-resizable-handle {0}'></div>".format(o.resizable?"JDialog-resizable-sw":"")),e.push("<div class='JDialog-content'>"),e.push("<div class='JDialog-header'>"),e.push("<button type='button' class='close'><span>×</span></button>"),e.push("<h4 class='JDialog-title'>{0}</h4>".format(o.title)),e.push("</div>"),e.push("<div class='JDialog-body'>"),e.push(t.$element.html()),e.push("</div>"),i.isEmptyObject(o.buttons)||(e.push("<div class='JDialog-footer'>"),i.each(o.buttons,function(i,t){e.push("<button class='btn btn-default'>{0}</button>".format(i))}),e.push("</div>")),e.push("</div>"),e.push("</div>"),e.push("</div>"),t.$body.append(e.join("")),t.currentDialog=i("#"+t.currentDialogID)},a=function(t){var o=t.$body.children(".JDialog"),e=[];o.each(function(t,o){var a=i(o),n=parseInt(a.attr("id").replace("JDialog_",""));e.push(n)});var a=e.length?e.max():0,n=a+1;return n},n=function(t){var o=t.options;t.currentDialog.find(".JDialog-header").off().mouseover(function(){i(this).css("cursor","move")}).mousedown(function(o){var e=!0,a=o.pageX-i(this).parent().offset().left,n=o.pageY-i(this).parent().offset().top;t.$doc.mousemove(function(i){e&&t.currentDialog.offset({left:i.pageX-a,top:i.pageY-n})}).mouseup(function(){e=!1,t.$doc.off("mousemove mouseup")})}),o.resizable&&t.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").off().mousedown(function(e){var a,n,s,l,h,g,d,u,c,p,f,D=i(this),m=D.attr("class"),v=m.split(" ")[1].split("-")[2];p=!0,l=D.parent(".JDialog-dialog").offset().top,n=e.pageY,h=D.parent(".JDialog-dialog").outerHeight(),c=D.parent(".JDialog-dialog").offset().left,u=e.pageX,f=D.parent(".JDialog-dialog").outerWidth(),t.$doc.mousemove(function(i){if(p)switch(a=i.pageY,g=i.pageX,d=g-u,s=a-n,v){case"n":var e=h-s;e=e<o.minHeight?o.minHeight:e,D.parent(".JDialog-dialog").height(e+"px"),D.parents(".JDialog").css("top",l+h-e+"px"),r(t);break;case"e":var m=f+d;m=m<o.minWidth?o.minWidth:m,D.parent(".JDialog-dialog").width(m+"px");break;case"s":e=h+s;e=e<o.minHeight?o.minHeight:e,D.parent(".JDialog-dialog").height(e+"px"),r(t);break;case"w":m=f-d;m=m<o.minWidth?o.minWidth:m,D.parent(".JDialog-dialog").width(m+"px"),D.parents(".JDialog").css("left",c+(f-m)+"px");break;case"se":m=f+d;m=m<o.minWidth?o.minWidth:m;e=h+s;e=e<o.minHeight?o.minHeight:e,D.parent(".JDialog-dialog").width(m+"px"),D.parent(".JDialog-dialog").height(e+"px"),r(t);break;case"sw":e=h+s;e=e<o.minHeight?o.minHeight:e;m=f-d;m=m<o.minWidth?o.minWidth:m,D.parent(".JDialog-dialog").width(m+"px"),D.parent(".JDialog-dialog").height(e+"px"),D.parents(".JDialog").css("left",c+(f-m)+"px"),r(t)}}).mouseup(function(i){p=!1,i.preventDefault(),i.stopPropagation(),t.$doc.off("mousemove mouseup")})})},s=function(t){var o=t.options;t.currentDialog.find("div.JDialog-content div.JDialog-header button.close").off("click").on("click",function(i){t.hide(),o.close&&"function"==typeof o.close&&o.close(i)}),t.currentDialog.find("div.JDialog-content div.JDialog-footer button").off("click").on("click",function(){var t=i(this);o.buttons[t.text()](this,event)})},r=function(i){i.options;var t=i.currentDialog.find(".JDialog-dialog").height(),o=i.currentDialog.find(".JDialog-body").outerHeight()-i.currentDialog.find(".JDialog-body").height(),e=i.currentDialog.find(".JDialog-header").outerHeight(),a=i.currentDialog.find(".JDialog-footer").outerHeight(),n=(t-o-e-a).toString()+"px";i.currentDialog.find(".JDialog-body").height(n)},l=i.fn.jDialog;i.fn.jDialog=t,i.fn.jDialog.Constructor=o,i.fn.jDialog.noConflict=function(){return i.fn.jDialog=l,this},void 0===String.prototype.format&&(String.prototype.format=function(){var i=arguments;return this.replace(/\{(\d+)\}/g,function(t,o){return i[o]})}),void 0===Array.prototype.max&&(Array.prototype.max=function(){for(var i=this[0],t=this.length,o=1;o<t;o++)this[o]>i&&(i=this[o]);return i})})(jQuery);