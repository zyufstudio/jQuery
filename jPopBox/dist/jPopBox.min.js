!function(m){var i=[],d=/^url\(["']?([^"'\)]*)["']?\);?$/i,l=/\.png$/i,t=!!window.createPopup,c=t&&void 0===document.documentElement.currentStyle.minWidth,u=t&&!document.defaultView;m(window).resize(function(){m.each(i,function(){this.refresh(!0)})}),m.JPopBox=function(t,i){this.$elm=m(t),this.opts=m.extend({},m.fn.jPopBox.defaults,i);var s=""!=this.opts.idName?"id="+this.opts.idName:"",e="";""!=this.opts.title&&(e='<div class="tip-title">'+this.opts.title+"</div>"),this.$tip=m(["<div ",s,' class="',this.opts.className,'">',e,'<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>',"</div>"].join("")).appendTo(document.body),this.$arrow=this.$tip.find("div.tip-arrow"),this.$inner=this.$tip.find("div.tip-inner"),this.disabled=!1,this.content=null,this.init()},m.JPopBox.hideAll=function(){m.each(i,function(){this.hide()})},m.JPopBox.prototype={init:function(){i.push(this);var t=this.$elm.attr("title");if(this.$elm.data("title.jPopBox",void 0!==t?t:null).data("jPopBox",this),"none"!=this.opts.showOn)switch(this.$elm.bind({"mouseenter.jPopBox":m.proxy(this.mouseenter,this),"mouseleave.jPopBox":m.proxy(this.mouseleave,this)}),this.opts.showOn){case"hover":"cursor"==this.opts.alignTo&&this.$elm.bind("mousemove.jPopBox",m.proxy(this.mousemove,this)),this.opts.allowTipHover&&this.$tip.hover(m.proxy(this.clearTimeouts,this),m.proxy(this.mouseleave,this));break;case"focus":this.$elm.bind({"focus.jPopBox":m.proxy(this.showDelayed,this),"blur.jPopBox":m.proxy(this.hideDelayed,this)})}},mouseenter:function(t){return!!this.disabled||(this.updateCursorPos(t),this.$elm.attr("title",""),"focus"==this.opts.showOn||void this.showDelayed())},mouseleave:function(t){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===t.relatedTarget||jQuery.contains(this.$tip[0],t.relatedTarget)))return!0;if(!this.$tip.data("active")){var i=this.$elm.data("title.jPopBox");null!==i&&this.$elm.attr("title",i)}if("focus"==this.opts.showOn)return!0;this.hideDelayed()},mousemove:function(t){if(this.disabled)return!0;this.updateCursorPos(t),this.opts.followCursor&&this.$tip.data("active")&&(this.calcPos(),this.$tip.css({left:this.pos.l,top:this.pos.t}),this.pos.arrow&&(this.$arrow[0].className="tip-arrow tip-arrow-"+this.opts.placement))},show:function(){this.disabled||this.$tip.data("active")||(this.reset(),this.update(),this.content&&(this.display(),this.opts.timeOnScreen&&this.hideDelayed(this.opts.timeOnScreen)))},showDelayed:function(t){this.clearTimeouts(),this.showTimeout=setTimeout(m.proxy(this.show,this),"number"==typeof t?t:this.opts.showTimeout)},hide:function(){!this.disabled&&this.$tip.data("active")&&this.display(!0)},hideDelayed:function(t){this.clearTimeouts(),this.hideTimeout=setTimeout(m.proxy(this.hide,this),"number"==typeof t?t:this.opts.hideTimeout)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",!1),this.$inner.find("*").jPopBox("hide"),this.opts.fade&&this.$tip.css("opacity",this.opacity),this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left",this.asyncAnimating=!1},update:function(t,i){if(!this.disabled){var s=void 0!==t;if(s){if(i||(this.opts.content=t),!this.$tip.data("active"))return}else t=this.opts.content;var e=this,o="function"==typeof t?t.call(this.$elm[0],function(t){e.update(t)}):"[title]"==t?this.$elm.data("title.jPopBox"):t;this.content!==o&&(this.$inner.empty().append(o),this.content=o),this.refresh(s)}},refresh:function(t){if(!this.disabled){if(t){if(!this.$tip.data("active"))return;var i={left:this.$tip.css("left"),top:this.$tip.css("top")}}this.$tip.css({left:0,top:0}).appendTo(document.body),void 0===this.opacity&&(this.opacity=this.$tip.css("opacity"));var s=this.$tip.css("background-image").match(d),e=!0;if(s){var o=l.test(s[1]);c&&o?(this.$tip.css("background-image","none"),this.$inner.css({margin:0,border:0,padding:0}),s=o=!1):this.$tip.prepend('<table class="tip-table" border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,"background-image":"none","background-color":"transparent"}).find(".tip-bg-image").css("background-image",'url("'+s[1]+'")').end().find("td").eq(3).append(this.$inner),o&&u&&(this.opts.fade=!1)}e&&u&&(c&&l.test(e[1])&&(e=!1,this.$arrow.css("background-image","none")),this.opts.fade=!1);var a=this.$tip.find("> table.tip-table");if(c){this.$tip[0].style.width="",a.width("auto").find("td").eq(3).width("auto");var h=this.$tip.width(),r=parseInt(this.$tip.css("min-width")),n=parseInt(this.$tip.css("max-width"));!isNaN(r)&&h<r?h=r:!isNaN(n)&&n<h&&(h=n),this.$tip.add(a).width(h).eq(0).find("td").eq(3).width("100%")}else a[0]&&a.width("auto").find("td").eq(3).width("auto").end().end().width(document.defaultView&&document.defaultView.getComputedStyle&&parseFloat(document.defaultView.getComputedStyle(this.$tip[0],null).width)||this.$tip.width()).find("td").eq(3).width("100%");if(e&&this.$arrow.css("visibility","inherit"),this.tipOuterW=this.$tip.outerWidth(),this.tipOuterH=this.$tip.outerHeight(),this.calcPos(),t&&this.opts.refreshAniDuration){this.asyncAnimating=!0;var p=this;this.$tip.css(i).animate({left:this.pos.l,top:this.pos.t},this.opts.refreshAniDuration,function(){p.asyncAnimating=!1})}else this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(t){var i=this.$tip.data("active");if(!(i&&!t||!i&&t)){if(this.$tip.stop(),(this.opts.slide&&this.pos.arrow||this.opts.fade)&&(t&&this.opts.hideAniDuration||!t&&this.opts.showAniDuration)){var s={},e={};if(this.opts.slide&&this.pos.arrow){var o,a;a="bottom"==this.pos.arrow||"top"==this.pos.arrow?(o="top","bottom"):(o="left","right");var h=parseInt(this.$tip.css(o));s[o]=h+(t?0:this.pos.arrow==a?-this.opts.slideOffset:this.opts.slideOffset),e[o]=h+(t?this.pos.arrow==a?this.opts.slideOffset:-this.opts.slideOffset:0)+"px"}this.opts.fade&&(s.opacity=t?this.$tip.css("opacity"):0,e.opacity=t?0:this.opacity),this.$tip.css(s).animate(e,this.opts[t?"hideAniDuration":"showAniDuration"])}if(t?this.$tip.queue(m.proxy(this.reset,this)):this.$tip.css("visibility","inherit"),i){var r=this.$elm.data("title.jPopBox");null!==r&&this.$elm.attr("title",r)}this.$tip.data("active",!i)}},disable:function(){this.reset(),this.disabled=!0},enable:function(){this.disabled=!1},destroy:function(){this.reset(),this.$tip.remove(),delete this.$tip,this.content=null,this.$elm.unbind(".jPopBox").removeData("title.jPopBox").removeData("jPopBox"),i.splice(m.inArray(this,i),1)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0)},updateCursorPos:function(t){this.eventX=t.pageX,this.eventY=t.pageY},calcPos:function(){var t,i,s,e,o,a,h,r,n,p={l:0,t:0,arrow:""},d=m(window),l={l:d.scrollLeft(),t:d.scrollTop(),w:d.width(),h:d.height()};if("cursor"==this.opts.alignTo)t=i=s=this.eventX,e=o=a=this.eventY;else{var c=this.$elm.offset(),u={l:c.left,t:c.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};i=(t=u.l)+Math.floor(u.w/2),s=t+u.w,o=(e=u.t)+Math.floor(u.h/2),a=e+u.h}r=this.opts.placement;var f=/\s?auto?\s?/i;switch((n=f.test(r))&&(r=r.replace(f,"")||"top"),r){case"top":case"bottom":p.l=i-Math.floor(this.tipOuterW/2),this.opts.keepInViewport&&(p.l+this.tipOuterW>l.l+l.w?p.l=l.l+l.w-this.tipOuterW:p.l<l.l&&(p.l=l.l));break;case"right":h=this.setArrowAndGetWH(r),p.l=s+this.opts.offsetX+h.W,n&&p.l+this.tipOuterW>l.l+l.w&&(h=this.setArrowAndGetWH("left"),p.l=t-this.tipOuterW-this.opts.offsetX-h.W);break;case"left":h=this.setArrowAndGetWH(r),p.l=t-this.tipOuterW-this.opts.offsetX-h.W,n&&p.l<l.l&&(h=this.setArrowAndGetWH("right"),p.l=s+this.opts.offsetX+h.W)}switch(r){case"top":h=this.setArrowAndGetWH(r),p.t=e-this.tipOuterH-this.opts.offsetY-h.H,n&&p.t<l.t&&(h=this.setArrowAndGetWH("bottom"),p.t=a+this.opts.offsetY+h.H);break;case"bottom":h=this.setArrowAndGetWH(r),p.t=a+this.opts.offsetY+h.H,n&&p.t+this.tipOuterH>l.t+l.h&&(h=this.setArrowAndGetWH("top"),p.t=e-this.tipOuterH-this.opts.offsetY-h.H);break;case"right":case"left":p.t=o-Math.floor(this.tipOuterH/2),this.opts.keepInViewport&&(p.t+this.tipOuterH>l.t+l.h?p.t=l.t+l.h-this.tipOuterH:p.t<l.t&&(p.t=l.t))}this.pos=p},setArrowAndGetWH:function(t){var i={};return this.$arrow[0].className="tip-arrow tip-arrow-"+t,W=this.$arrow.outerWidth(),H=this.$arrow.outerHeight(),i.W=W,i.H=H,i}},m.fn.jPopBox=function(t){if("string"==typeof t){var i=arguments,s=t;return Array.prototype.shift.call(i),"destroy"==s&&(this.die?this.die("mouseenter.jPopBox").die("focus.jPopBox"):m(document).undelegate(this.selector,"mouseenter.jPopBox").undelegate(this.selector,"focus.jPopBox")),this.each(function(){var t=m(this).data("jPopBox");t&&t[s]&&t[s].apply(t,i)})}var e=m.extend({},m.fn.jPopBox.defaults,t);if(m("#jPopBox-css-"+e.className)[0]||m(['<style id="jPopBox-css-',e.className,'" type="text/css">',"div.",e.className,"{visibility:hidden;position:absolute;top:0;left:0;}","div.",e.className," table.tip-table, div.",e.className," table.tip-table td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;vertical-align:middle;}","div.",e.className," td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:",e.bgImageFrameSize,"px;width:",e.bgImageFrameSize,"px;overflow:hidden;}","div.",e.className," td.tip-right{background-position:100% 0;}","div.",e.className," td.tip-bottom{background-position:100% 100%;}","div.",e.className," td.tip-left{background-position:0 100%;}","div.",e.className," div.tip-inner{background-position:-",e.bgImageFrameSize,"px -",e.bgImageFrameSize,"px;}","div.",e.className," div.tip-arrow{visibility:hidden;position:absolute;font:1px/1px sans-serif;}","</style>"].join("")).appendTo("head"),e.liveEvents&&"none"!=e.showOn){var o,a=m.extend({},e,{liveEvents:!1});switch(e.showOn){case"hover":o=function(){var t=m(this);t.data("jPopBox")||t.jPopBox(a).jPopBox("mouseenter")},this.live?this.live("mouseenter.jPopBox",o):m(document).delegate(this.selector,"mouseenter.jPopBox",o);break;case"focus":o=function(){var t=m(this);t.data("jPopBox")||t.jPopBox(a).jPopBox("showDelayed")},this.live?this.live("focus.jPopBox",o):m(document).delegate(this.selector,"focus.jPopBox",o)}return this}return this.each(function(){new m.JPopBox(this,e)})},m.fn.jPopBox.defaults={content:"[title]",className:"tip-yellow",idName:"",bgImageFrameSize:10,showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:"hover",liveEvents:!1,alignTo:"cursor",alignX:"right",alignY:"top",offsetX:0,offsetY:0,keepInViewport:!0,allowTipHover:!0,followCursor:!1,fade:!0,slide:!0,slideOffset:8,showAniDuration:300,hideAniDuration:300,refreshAniDuration:200,title:"",placement:"top"}}(jQuery);