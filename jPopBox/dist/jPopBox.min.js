!function(w){var t=[];w(window).resize(function(){w.each(t,function(){this.refresh(!0)})}),w.JPopBox=function(t,i){this.$elm=w(t),this.opts=this.getOptions(i);var s=[];s.push('<div class="'+this.opts.className+'">'),""!=this.opts.title&&s.push('<div class="tip-title">'+this.opts.title+"</div>"),this.opts.isShowArrow&&s.push('<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left" style="visibility:inherit"></div>'),s.push('<div class="tip-content"></div>'),s.push("</div>"),this.$tip=w(s.join("")).appendTo(document.body),this.$arrow=this.$tip.find("div.tip-arrow"),this.$inner=this.$tip.find("div.tip-content"),this.disabled=!1,this.content=null,this.init()},w.JPopBox.hideAll=function(){w.each(t,function(){this.hide()})},w.JPopBox.prototype={getOptions:function(t){return(t=w.extend({},w.fn.jPopBox.defaults,t)).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.offset&&(t.offset={X:t.offset,Y:t.offset}),t},init:function(){if(t.push(this),this.$elm.data("jPopBox",this),"none"!=this.opts.trigger)switch("click"!=this.opts.trigger&&this.$elm.on({"mouseenter.jPopBox":w.proxy(this.mouseenter,this),"mouseleave.jPopBox":w.proxy(this.mouseleave,this)}),this.opts.trigger){case"click":this.$elm.on("click.jPopBox",w.proxy(this.toggle,this));break;case"hover":this.opts.isTipHover&&this.$tip.hover(w.proxy(this.clearTimeouts,this),w.proxy(this.mouseleave,this));break;case"focus":this.$elm.on({"focus.jPopBox":w.proxy(this.showDelayed,this),"blur.jPopBox":w.proxy(this.hideDelayed,this)})}},toggle:function(){this.$tip.data("active")?this.hideDelayed():this.showDelayed()},mouseenter:function(t){return!!this.disabled||(this.updateCursorPos(t),this.$elm.attr("title",""),"focus"==this.opts.trigger||void this.showDelayed())},mouseleave:function(t){return!!(this.disabled||this.asyncAnimating&&(this.$tip[0]===t.relatedTarget||jQuery.contains(this.$tip[0],t.relatedTarget)))||("focus"==this.opts.trigger||void this.hideDelayed())},mousemove:function(t){if(this.disabled)return!0;this.updateCursorPos(t),this.opts.isFollowCursor&&this.$tip.data("active")&&(this.calcPos(),this.$tip.css({left:this.pos.l,top:this.pos.t}))},show:function(){var t=w.Event("show.jPopBox");if(this.$elm.trigger(t),!this.disabled&&!this.$tip.data("active")&&(this.reset(),this.update(),this.content)){this.display();t=w.Event("shown.jPopBox");this.$elm.trigger(t)}},showDelayed:function(){this.clearTimeouts(),this.showTimeout=setTimeout(w.proxy(this.show,this),this.opts.delay.show)},hide:function(){!this.disabled&&this.$tip.data("active")&&this.display(!0)},hideDelayed:function(){this.clearTimeouts(),this.hideTimeout=setTimeout(w.proxy(this.hide,this),this.opts.delay.hide)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",!1),this.$inner.find("*").jPopBox("hide"),this.$arrow.length&&(this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"),this.asyncAnimating=!1},update:function(t,i){if(!this.disabled){var s=void 0!==t;if(s){if(i||(this.opts.content=t),!this.$tip.data("active"))return}else t=this.opts.content;var e=this,o="function"==typeof t?t.call(this.$elm[0],function(t){e.update(t)}):t;this.content!==o&&(this.$inner.empty().append(o),this.content=o),this.refresh(s)}},refresh:function(t){this.disabled||t&&!this.$tip.data("active")||(this.$tip.css({left:0,top:0}).appendTo(document.body),void 0===this.opacity&&(this.opacity=this.$tip.css("opacity")),this.calcPos(),this.$tip.css({left:this.pos.l,top:this.pos.t}))},display:function(t){var i=this.$tip.data("active");if(!(i&&!t||!i&&t)){this.$tip.stop();var s={},e={};s.opacity=t?this.$tip.css("opacity"):0,e.opacity=t?0:this.opacity,this.$tip.css(s).animate(e,300),t?this.$tip.queue(w.proxy(this.reset,this)):this.$tip.css("visibility","inherit"),this.$tip.data("active",!i)}},disable:function(){this.reset(),this.disabled=!0},enable:function(){this.disabled=!1},destroy:function(){this.reset(),this.$tip.remove(),delete this.$tip,this.content=null,this.$elm.off(".jPopBox").removeData("jPopBox"),t.splice(w.inArray(this,t),1)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0)},updateCursorPos:function(t){this.eventX=t.pageX,this.eventY=t.pageY},calcPos:function(){this.tipOuterW=this.$tip.outerWidth(),this.tipOuterH=this.$tip.outerHeight();var t,i,s,e,o,h,r,a,p,n={l:0,t:0,arrow:""},l=w(window),c={l:l.scrollLeft(),t:l.scrollTop(),w:l.width(),h:l.height()},d=this.$elm.offset(),u={l:d.left,t:d.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};i=(t=u.l)+Math.floor(u.w/2),s=t+u.w,o=(e=u.t)+Math.floor(u.h/2),h=e+u.h,a=this.opts.placement;var f=/\s?auto?\s?/i;switch((p=f.test(a))&&(a=a.replace(f,"")||"top"),a){case"top":case"bottom":n.l=i-Math.floor(this.tipOuterW/2)-this.opts.offset.X,n.l+this.tipOuterW>c.l+c.w?n.l=c.l+c.w-this.tipOuterW:n.l<c.l&&(n.l=c.l);break;case"right":r=this.setArrowAndGetWH(a),n.l=s+this.opts.offset.X+r.W,p&&n.l+this.tipOuterW>c.l+c.w&&(r=this.setArrowAndGetWH("left"),n.l=t-this.tipOuterW-this.opts.offset.X-r.W);break;case"left":r=this.setArrowAndGetWH(a),n.l=t-this.tipOuterW-this.opts.offset.X-r.W,p&&n.l<c.l&&(r=this.setArrowAndGetWH("right"),n.l=s+this.opts.offset.X+r.W)}switch(a){case"top":r=this.setArrowAndGetWH(a),n.t=e-this.tipOuterH-this.opts.offset.Y-r.H,p&&n.t<c.t&&(r=this.setArrowAndGetWH("bottom"),n.t=h+this.opts.offset.Y+r.H);break;case"bottom":r=this.setArrowAndGetWH(a),n.t=h+this.opts.offset.Y+r.H,p&&n.t+this.tipOuterH>c.t+c.h&&(r=this.setArrowAndGetWH("top"),n.t=e-this.tipOuterH-this.opts.offset.Y-r.H);break;case"right":case"left":n.t=o-Math.floor(this.tipOuterH/2)-this.opts.offset.Y,n.t+this.tipOuterH>c.t+c.h?n.t=c.t+c.h-this.tipOuterH:n.t<c.t&&(n.t=c.t)}this.pos=n},setArrowAndGetWH:function(t){var i={},s=0,e=0;return this.$arrow.length&&(this.$arrow.attr("class","tip-arrow tip-arrow-"+t),s=this.$arrow.outerWidth(),e=this.$arrow.outerHeight()),i.W=s,i.H=e,i}},w.fn.jPopBox=function(t){if("string"==typeof t){var i=arguments,s=t;return Array.prototype.shift.call(i),"destroy"==s&&(this.die?this.die("mouseenter.jPopBox").die("focus.jPopBox"):w(document).undelegate(this.selector,"mouseenter.jPopBox").undelegate(this.selector,"focus.jPopBox")),this.each(function(){var t=w(this).data("jPopBox");t&&t[s]&&t[s].apply(t,i)})}var e=w.extend({},w.fn.jPopBox.defaults,t);return w("#jPopBox-css-"+e.className)[0]||w(['<style id="jPopBox-css-',e.className,'" type="text/css">',"div.",e.className,"{visibility:hidden;position:absolute;top:0;left:0;}","div.",e.className," div.tip-arrow{visibility:hidden;position:absolute;font:1px/1px sans-serif;}","</style>"].join("")).appendTo("head"),this.each(function(){new w.JPopBox(this,e)})},w.fn.jPopBox.defaults={title:"",content:"",className:"tip-white",placement:"top",delay:100,trigger:"hover",offset:0,isShowArrow:!0,isTipHover:!0}}(jQuery);